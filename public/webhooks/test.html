<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransactLab - Webhook Testing</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .response-area {
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            overflow-y: auto;
        }

        .status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .webhook-events {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .event-card {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            transition: border-color 0.3s ease;
        }

        .event-card:hover {
            border-color: #667eea;
        }

        .event-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .event-card p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .event-card .btn {
            width: 100%;
            margin-top: 10px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e1e5e9;
            margin-bottom: 30px;
        }

        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ”— Webhook Testing</h1>
            <p>Test webhook delivery and event simulation</p>
        </div>

        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="showTab('testing')">Webhook Testing</button>
                <button class="tab" onclick="showTab('events')">Event Types</button>
                <button class="tab" onclick="showTab('docs')">Documentation</button>
            </div>

            <!-- Webhook Testing Tab -->
            <div id="testing" class="tab-content active">
                <div class="section">
                    <h2>ðŸ”§ Webhook Configuration</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="webhookUrl">Webhook URL</label>
                            <input type="url" id="webhookUrl" placeholder="https://your-domain.com/webhook" value="https://webhook.site/your-unique-url">
                        </div>
                        <div class="form-group">
                            <label for="webhookSecret">Webhook Secret</label>
                            <input type="text" id="webhookSecret" placeholder="Your webhook secret" value="whsec_test_secret">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>ðŸ“Š Test Data</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventType">Event Type</label>
                            <select id="eventType">
                                <option value="payment.success">Payment Success</option>
                                <option value="payment.failed">Payment Failed</option>
                                <option value="refund.processed">Refund Processed</option>
                                <option value="subscription.created">Subscription Created</option>
                                <option value="subscription.cancelled">Subscription Cancelled</option>
                                <option value="customer.created">Customer Created</option>
                                <option value="webhook.test">Webhook Test</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="amount">Amount (NGN)</label>
                            <input type="number" id="amount" placeholder="5000" value="5000">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="customerEmail">Customer Email</label>
                        <input type="email" id="customerEmail" placeholder="customer@example.com" value="test@transactlab.com">
                    </div>
                    <div class="form-group">
                        <label for="reference">Transaction Reference</label>
                        <input type="text" id="reference" placeholder="TXN_123456" value="TXN_TEST_123456">
                    </div>
                </div>

                <div class="section">
                    <h2>ðŸš€ Send Test Webhook</h2>
                    <button class="btn" onclick="sendTestWebhook()">Send Test Webhook</button>
                    <button class="btn btn-secondary" onclick="clearResponse()">Clear Response</button>
                    
                    <div id="response" class="response-area" style="display: none;">
                        <div id="responseContent"></div>
                    </div>
                </div>
            </div>

            <!-- Event Types Tab -->
            <div id="events" class="tab-content">
                <div class="section">
                    <h2>ðŸ“‹ Available Event Types</h2>
                    <div class="webhook-events">
                        <div class="event-card">
                            <h3>ðŸ’³ Payment Events</h3>
                            <p>Events triggered by payment processing</p>
                            <button class="btn" onclick="testEvent('payment.success')">Payment Success</button>
                            <button class="btn btn-danger" onclick="testEvent('payment.failed')">Payment Failed</button>
                        </div>

                        <div class="event-card">
                            <h3>ðŸ’° Refund Events</h3>
                            <p>Events triggered by refund processing</p>
                            <button class="btn btn-success" onclick="testEvent('refund.processed')">Refund Processed</button>
                            <button class="btn btn-danger" onclick="testEvent('refund.failed')">Refund Failed</button>
                        </div>

                        <div class="event-card">
                            <h3>ðŸ”„ Subscription Events</h3>
                            <p>Events triggered by subscription management</p>
                            <button class="btn" onclick="testEvent('subscription.created')">Subscription Created</button>
                            <button class="btn btn-danger" onclick="testEvent('subscription.cancelled')">Subscription Cancelled</button>
                        </div>

                        <div class="event-card">
                            <h3>ðŸ‘¤ Customer Events</h3>
                            <p>Events triggered by customer management</p>
                            <button class="btn" onclick="testEvent('customer.created')">Customer Created</button>
                            <button class="btn" onclick="testEvent('customer.updated')">Customer Updated</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documentation Tab -->
            <div id="docs" class="tab-content">
                <div class="section">
                    <h2>ðŸ“š Webhook Documentation</h2>
                    <h3>Webhook URL Setup</h3>
                    <p>Configure your webhook URL to receive real-time notifications from TransactLab.</p>
                    
                    <h3>Event Structure</h3>
                    <pre class="response-area">
{
  "event": "payment.success",
  "timestamp": "2024-01-15T10:30:00Z",
  "data": {
    "id": "txn_123456",
    "reference": "TXN_123456",
    "amount": 5000,
    "currency": "NGN",
    "status": "successful",
    "customer": {
      "email": "customer@example.com",
      "name": "John Doe"
    },
    "payment_method": "card",
    "created_at": "2024-01-15T10:30:00Z"
  }
}</pre>

                    <h3>Security</h3>
                    <p>All webhooks are signed with HMAC-SHA256. Verify the signature to ensure authenticity:</p>
                    <pre class="response-area">
// Node.js example
const crypto = require('crypto');
const signature = crypto
  .createHmac('sha256', webhookSecret)
  .update(JSON.stringify(payload))
  .digest('hex');

if (signature === receivedSignature) {
  // Webhook is authentic
}</pre>

                    <h3>Retry Logic</h3>
                    <p>TransactLab will retry failed webhook deliveries up to 3 times with exponential backoff.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        async function sendTestWebhook() {
            const webhookUrl = document.getElementById('webhookUrl').value;
            const webhookSecret = document.getElementById('webhookSecret').value;
            const eventType = document.getElementById('eventType').value;
            const amount = document.getElementById('amount').value;
            const customerEmail = document.getElementById('customerEmail').value;
            const reference = document.getElementById('reference').value;

            if (!webhookUrl) {
                alert('Please enter a webhook URL');
                return;
            }

            const payload = generateTestPayload(eventType, amount, customerEmail, reference);
            
            try {
                const response = await fetch('/api/v1/webhooks/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        url: webhookUrl,
                        secret: webhookSecret,
                        payload: payload
                    })
                });

                const result = await response.json();
                displayResponse(result);
            } catch (error) {
                displayResponse({
                    success: false,
                    error: 'Failed to send test webhook: ' + error.message
                });
            }
        }

        function testEvent(eventType) {
            document.getElementById('eventType').value = eventType;
            sendTestWebhook();
        }

        function generateTestPayload(eventType, amount, customerEmail, reference) {
            const basePayload = {
                event: eventType,
                timestamp: new Date().toISOString(),
                data: {
                    id: reference,
                    reference: reference,
                    amount: parseInt(amount),
                    currency: 'NGN',
                    customer: {
                        email: customerEmail,
                        name: 'Test Customer'
                    },
                    created_at: new Date().toISOString()
                }
            };

            switch (eventType) {
                case 'payment.success':
                    basePayload.data.status = 'successful';
                    basePayload.data.payment_method = 'card';
                    break;
                case 'payment.failed':
                    basePayload.data.status = 'failed';
                    basePayload.data.reason = 'Insufficient funds';
                    break;
                case 'refund.processed':
                    basePayload.data.status = 'processed';
                    basePayload.data.refund_amount = parseInt(amount);
                    break;
                case 'subscription.created':
                    basePayload.data.status = 'active';
                    basePayload.data.interval = 'monthly';
                    break;
                case 'subscription.cancelled':
                    basePayload.data.status = 'cancelled';
                    basePayload.data.cancelled_at = new Date().toISOString();
                    break;
                case 'customer.created':
                    basePayload.data.status = 'active';
                    basePayload.data.created_at = new Date().toISOString();
                    break;
            }

            return basePayload;
        }

        function displayResponse(response) {
            const responseDiv = document.getElementById('response');
            const contentDiv = document.getElementById('responseContent');
            
            let html = '<h3>Response:</h3>';
            
            if (response.success) {
                html += `<div class="status success">SUCCESS</div>`;
            } else {
                html += `<div class="status error">ERROR</div>`;
            }
            
            html += `<pre>${JSON.stringify(response, null, 2)}</pre>`;
            
            contentDiv.innerHTML = html;
            responseDiv.style.display = 'block';
        }

        function clearResponse() {
            document.getElementById('response').style.display = 'none';
        }
    </script>
</body>
</html> 